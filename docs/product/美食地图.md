# 美食世界地图打卡 · MVP（核心版）

## 1) 目标

- 吃过即打卡，点亮国家；形成“美食护照”，提升留存与分享意愿。

## 2) 范围（MVP）

- 国家级点亮（ISO 国家）。
- 两个入口：菜品详情“我吃过”、自由打卡（搜索/自定义菜名+选国家）。
- 地图页展示：已点亮国家高亮，悬停/点击看数量与最近记录。
- 基础成就：① 首次点亮；② 连续打卡 7 天；③ 单国 3 菜。

## 3) 核心用户故事

- 我在菜品详情点“我吃过”，对应国家点亮。
- 我找不到菜时，可自定义菜名并选择国家完成打卡。
- 我在地图页能看到已点亮国家数量与最近打卡。
- 我解锁成就时得到提示，并在“我的”页查看。

## 4) 核心流程

**打卡**：入口 →（菜匹配国家；不唯一则选国家）→ 记录打卡 → 点亮国家（如首次）→ 成就判定。
**地图**：加载我的国家点亮状态 → 高亮国家 → 悬停/点击显示统计与最近 5 条。

## 5) 规则（MVP）

- 映射：`cuisine/tags → 国家`；不唯一需人工选国家；自定义菜必选国家。
- 去重：同菜同日仅记 1 次；点亮不重复增量。
- 撤销：仅撤销该菜“最近一次”打卡；撤销后若该国无记录则回退未点亮。
- 连续天判定：按用户所在时区的自然日。
- 轻量防刷：同菜同日限制；前端 1 分钟内多次提交节流提示。

## 6) 数据（概念，非代码）

- `user_checkins`：`user_id`, `dish_id | custom_name`, `country_code`, `source(dish|manual)`, `ts`
- `user_map_states`：`user_id`, `country_code`, `first_checkin_ts`, `last_checkin_ts`, `count`
- `user_achievements`：`user_id`, `achievement_code`, `unlocked_ts`, `meta`

## 7) 指标（核心）

- DAU 打卡率、月人均打卡次数、累计人均点亮国家数、成就解锁率（7D）。

## 8) 上线验收清单

- [ ] 菜品详情可打卡并正确点亮国家
- [ ] 自由打卡支持搜索/自定义并强制选国家
- [ ] 地图正确高亮与统计展示
- [ ] 3 项成就可触发并可查看
- [ ] 去重/撤销/连续天按时区生效
- [ ] 导出“美食护照”静态图（昵称、点亮数、Top3 国家）
