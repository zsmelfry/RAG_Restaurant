flowchart LR
  subgraph Profile[用户画像模块]
    P1[口味指纹]
    P2["硬性限制<br/>(过敏/禁忌)"]
    P3["软性偏好<br/>(菜系/风味/预算)"]
  end

  subgraph Engine[在线推荐引擎]
    direction LR
    R1[① 召回]
    R2[② 过滤（安全/合规）]
    R3[③ 重排（相关性/多样性/探索）]
    R1 --> R2 --> R3
  end

  RC["实时条件<br/>(主题/时段/位置/预算本次/探索强度)"]
  OUT[[Top-N 推荐结果]]

  P1 --> R1
  P2 --> R2
  P3 --> R3

  RC --> R1
  RC --> R2
  RC --> R3

  R3 --> OUT
  OUT -- 反馈(喜欢/一般/不喜欢/收藏/屏蔽) --> P1
  OUT -- 反馈 --> P3
