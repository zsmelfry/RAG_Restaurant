{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://your-org/contracts/schemas/dish.schema.json",
    "title": "Dish",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "_id": {
        "type": "string",
        "description": "MongoDB ObjectId（服务侧生成）",
        "pattern": "^[a-f\\d]{24}$"
      },
      "name": {
        "type": "string",
        "minLength": 1,
        "maxLength": 200,
        "description": "菜名（存小写、去空格）"
      },
      "desc": {
        "type": "string",
        "minLength": 0,
        "maxLength": 2000,
        "description": "描述（可空；清洗阶段为空则回填 name）",
        "default": ""
      },
      "tags": {
        "type": "array",
        "description": "标签，如 spicy, vegetarian（存小写）",
        "items": { "type": "string", "minLength": 1, "maxLength": 50 },
        "uniqueItems": true,
        "default": []
      },
      "allergens": {
        "type": "array",
        "description": "过敏原，如 gluten, nuts（存小写；支持空）",
        "items": { "type": "string", "minLength": 1, "maxLength": 50 },
        "uniqueItems": true,
        "default": []
      },
      "image_url": {
        "type": ["string", "null"],
        "format": "uri",
        "maxLength": 1000,
        "description": "图片 URL",
        "default": null
      },
      "ingredients": {
        "type": "array",
        "description": "配料（尽量归一为名词短语，小写）",
        "items": { "type": "string", "minLength": 1, "maxLength": 100 },
        "uniqueItems": true,
        "default": []
      },
      "cuisine": {
        "type": ["string", "null"],
        "description": "菜系（如 chinese, french, japanese）",
        "maxLength": 50,
        "default": null
      },
      "lang": {
        "type": ["string", "null"],
        "description": "文本主语言，BCP-47（如 zh, en, fr）",
        "pattern": "^[A-Za-z]{2,3}(-[A-Za-z0-9]{2,8})*$",
        "default": null
      },
      "dict_codes": {
        "type": "object",
        "description": "归一化字典编码（便于检索/过滤）",
        "additionalProperties": false,
        "properties": {
          "allergens": {
            "type": "array",
            "items": { "type": "string", "minLength": 1, "maxLength": 50 },
            "uniqueItems": true,
            "default": []
          },
          "tags": {
            "type": "array",
            "items": { "type": "string", "minLength": 1, "maxLength": 50 },
            "uniqueItems": true,
            "default": []
          },
          "cuisine": {
            "type": ["string", "null"],
            "maxLength": 50,
            "default": null
          }
        },
        "default": { "allergens": [], "tags": [], "cuisine": null }
      },
      "extras": {
        "type": "object",
        "description": "可选扩展（保留演进空间）",
        "additionalProperties": true,
        "properties": {
          "fp_v1": {
            "type": ["string", "null"],
            "description": "菜品指纹，用于去重与合并",
            "maxLength": 100,
            "default": null
          }
        },
        "default": {}
      },
      "source": {
        "type": "object",
        "description": "数据来源信息（追踪/去重）",
        "additionalProperties": false,
        "properties": {
          "site": { "type": ["string", "null"], "maxLength": 100, "default": null },
          "url": { "type": ["string", "null"], "format": "uri", "maxLength": 1000, "default": null },
          "external_id": { "type": ["string", "null"], "maxLength": 200, "default": null },
          "ingest_batch": { "type": ["string", "null"], "maxLength": 100, "default": null }
        },
        "default": { "site": null, "url": null, "external_id": null, "ingest_batch": null }
      },
      "schema_version": {
        "type": "string",
        "const": "1.0.0",
        "description": "Schema 版本"
      },
      "created_at": { "type": "string", "format": "date-time" },
      "updated_at": { "type": "string", "format": "date-time" }
    },
    "required": [
      "name",
      "desc",
      "tags",
      "allergens",
      "schema_version",
      "created_at",
      "updated_at"
    ]
  }
  